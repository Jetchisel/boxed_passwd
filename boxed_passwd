#!/usr/bin/env bash
# ============================================================================================ #
#: Title           : boxed_passwd                                                              #
#: Sypnosis        : boxex_passwd SHELL                                                        #
#: Date Created    : Sat 27 Jun 2020 14:12:16 PM PST  /  Sat Jun 27 06:12:16 UTC 2020          #
#: Last Edit       : Sat 27 Jun 2020 14:18:42 PM PST  /  Sat Jun 27 06:18:42 UTC 2020          #
#: License         : GPL3+                                                                     #
#: Version         : 1.0.0                                                                     #
#: Maintainer      : Jason V. Ferrer '<jason@ferrer.com.ph>'                                   #
#: Description     : NONE                                                                      #
#: Options         : NONE                                                                      #
#: Home Page       : NONE                                                                      #
#: ExtComm         : grep,awk,ed,column,wc                                                     #
#: Copyright       : Jason V. Ferrer 2020-2021                                                 #
# ============================================================================================ #


shell=${1:-.*}

file=/etc/passwd

if [[ -n $shell ]]; then
  line_count=$(grep -c "/$shell$" "$file")
else
  line_count=$(wc -l < "$file")
fi

((line_count)) || {
  printf 'There are no match for %s please try again!\n' "$shell"
  exit 1
}

total=$((line_count * 2))

for ((i=1;i<=total;i+=2)); do
  array+=("$i"t"$i" "$((i+1))s/|/+/g" "$((i+1))s/[^+]/-/g" )
done

array=(
  '$t$'
  '$s/|/+/g'
  '$s/[^+]/-/g'
  "${array[@]}"
  '1t0'
  '1s/|/+/g'
  '1s/[^+]/-/g'
  ,p Q
)

mapfile -t passwd < <(
  printf '0a\nUsername:2:UID:GID:5:Home:Shell:/?bin/%s\n.\n,p\nQ\n' "$shell" |
  ed -s "$file"
)

ed -s <(
  printf '%s\n' "${passwd[@]}" |
  awk -v Shell="/$shell$" 'BEGIN { FS=":" ; OFS=" | "
  } $NF ~ Shell {
    print "| " $1, $3, $4, $6, $7 " |"
  }' | column -t
) < <(printf '%s\n' H "${array[@]}")
